System information OS Platform Distribution Arch Linux arch ARCH TensorFlow installed binary TensorFlow rc Keras GPU memory GTX Ti GB Describe current behavior executing MNIST handwriting produces error error dissapears OneDeviceStrategy MirroredStrategy W kernels generator dataset op Error occurred finalizing GeneratorDataset iterator Cancelled Operation cancelled Code reproduce datasets tfds time keras optimizers Adam build filters units kernel learning rate keras Sequential keras layers Conv D filters filters kernel kernel kernel activation relu shape keras layers MaxPooling D keras layers Flatten keras layers Dense units activation relu keras layers Dense activation softmax compile loss sparse categorical crossentropy optimizer Adam learning rate metrics accuracy datasets info tfds load name mnist info True supervised True mnist train mnist test datasets train datasets test num train examples info splits train num examples num test examples info splits test num examples strategy distribute OneDeviceStrategy gpu BUFFER SIZE BATCH SIZE scale image label image cast image float image image label train dataset mnist train map scale shuffle BUFFER SIZE repeat batch BATCH SIZE prefetch buffer experimental AUTOTUNE eval dataset mnist test map scale repeat batch BATCH SIZE prefetch buffer experimental AUTOTUNE strategy scope build epochs start time perf counter fit train dataset validation eval dataset steps per epoch num train examples epochs validation steps num test examples epochs epochs epochs elapsed time perf counter start print elapsed { f } format elapsed System information OS Platform Distribution Arch Linux arch ARCH TensorFlow installed binary TensorFlow rc Keras GPU memory GTX Ti GB Describe current behavior executing MNIST handwriting produces warning WARNING AutoGraph transform bound method TopLevelFeature decode FeaturesDict { image Image shape dtype uint label ClassLabel shape dtype num classes } Please report TensorFlow team When filing bug verbosity Linux export AUTOGRAPH VERBOSITY attach full Cause arguments object attribute defaults Code reproduce datasets tfds keras optimizers Adam build filters units kernel learning rate keras Sequential keras layers Conv D filters filters kernel kernel kernel activation relu shape keras layers MaxPooling D keras layers Flatten keras layers Dense units activation relu keras layers Dense activation softmax compile loss sparse categorical crossentropy optimizer Adam learning rate metrics accuracy datasets info tfds load name mnist info True supervised True mnist train mnist test datasets train datasets test num train examples info splits train num examples num test examples info splits test num examples BUFFER SIZE BATCH SIZE scale image label image cast image float image image label train dataset mnist train map scale shuffle BUFFER SIZE repeat batch BATCH SIZE prefetch buffer experimental AUTOTUNE eval dataset mnist test map scale repeat batch BATCH SIZE prefetch buffer experimental AUTOTUNE build epochs fit train dataset validation eval dataset steps per epoch num train examples epochs validation steps num test examples epochs epochs epochs System information Have written custom opposed using stock script provided TensorFlow A OS Platform Distribution Linux Ubuntu Ubuntu Mobile iPhone Pixel Samsung Galaxy happens mobile TensorFlow installed binary binary TensorFlow command rc Bazel compiling A GCC Compiler compiling A CUDA cuDNN V GPU memory Tesla V SXM Describe current behavior In Adam paper subtract following quantity current gradient alpha hat { } sqrt { beta } epsilon img width alt Screen Shot PM src images githubusercontent f db ea fe cae png The implementation subtracts subtly different quantity alpha hat { } sqrt { beta T } sqrt { } epsilon img width alt Screen Shot PM src images githubusercontent db ea f f png The difference two expressions first de bias moving average squared gradient In second bias correction also applied epsilon This manifests scaling epilson quite lot early training steps reducing magnitude gradient update Note bug present PyTorch prior It fixed PR pytorch pytorch pull That PR description provides useful visualization Describe expected behavior Implement algorithm described paper If old implementation necessary preserve back compat providing flag trigger correct implementation helpful arxiv pdf pdf see final lines Algorithm Notable lines TF implementation regarding blob r keras optimizer adam L blob r keras optimizer adam L blob master kernels training ops L em Please make sure build installation As per GitHub Policy blob master ISSUES md address bugs performance issues feature requests build installation issues GitHub tag build template em System information OS Platform Distribution Linux Ubuntu Manjaro Linux kernel TensorFlow installed binary binary sure pip install TensorFlow Installed using virtualenv pip conda pip This virtualenv environment though Describe problem Running upgrade async functions causes crash Provide exact sequence commands steps executed running problem upgrade infile image classification test outfile image classification test Traceback recent call last home alex bic bot bin upgrade module sys exit main home alex bic bot packages tools compatibility upgrade main main args upgrade home alex bic bot packages tools compatibility upgrade main process upgrader process filename filename home alex bic bot packages tools compatibility ast edits process temp home alex bic bot packages tools compatibility ast edits process opened self update string pasta join lines filename home alex bic bot packages tools compatibility ast edits update string pasta pasta parse text home alex bic bot packages pasta init parse annotator visit home alex bic bot packages pasta base annotate visit super AstAnnotator self visit home alex bic bot packages pasta base annotate visit super BaseVisitor self visit home alex pyenv versions ast visit visitor home alex bic bot packages pasta base annotate wrapped f self args kwargs home alex bic bot packages pasta base annotate visit Module self generic visit home alex pyenv versions ast generic visit self visit item home alex bic bot packages pasta base annotate visit super AstAnnotator self visit home alex bic bot packages pasta base annotate visit super BaseVisitor self visit home alex pyenv versions ast visit visitor home alex pyenv versions ast generic visit self visit item home alex bic bot packages pasta base annotate visit super AstAnnotator self visit home alex bic bot packages pasta base annotate visit super BaseVisitor self visit home alex pyenv versions ast visit visitor home alex bic bot packages pasta base annotate wrapped f self args kwargs home alex bic bot packages pasta base annotate visit Return self token home alex bic bot packages pasta base annotate token token val token src token start token pasta base annotate AnnotationError Expected async async f Any info logs test async f 