System information OS Platform Distribution Arch Linux arch ARCH TensorFlow installed binary TensorFlow version rc Keras version tf Python version GPU model memory x GTX Ti GB Describe current behavior executing Tensorflow MNIST handwriting example produces error error dissapears code use OneDeviceStrategy MirroredStrategy W tensorflow core kernels data generator dataset op cc Error occurred finalizing GeneratorDataset iterator Cancelled Operation cancelled Code reproduce issue import tensorflow tf import tensorflow datasets tfds import time tensorflow keras optimizers import Adam def build model filters units kernel size learning rate e model tf keras Sequential tf keras layers Conv D filters filters kernel size kernel size kernel size activation relu input shape tf keras layers MaxPooling D tf keras layers Flatten tf keras layers Dense units activation relu tf keras layers Dense activation softmax model compile loss sparse categorical crossentropy optimizer Adam learning rate metrics accuracy return model datasets info tfds load name mnist info True supervised True mnist train mnist test datasets train datasets test num train examples info splits train num examples num test examples info splits test num examples strategy tf distribute OneDeviceStrategy device gpu BUFFER SIZE BATCH SIZE def scale image label image tf cast image tf float image return image label train dataset mnist train map scale shuffle BUFFER SIZE repeat batch BATCH SIZE prefetch buffer size tf data experimental AUTOTUNE eval dataset mnist test map scale repeat batch BATCH SIZE prefetch buffer size tf data experimental AUTOTUNE strategy scope model build model epochs start time perf counter model fit train dataset validation data eval dataset steps per epoch num train examples epochs validation steps num test examples epochs epochs epochs elapsed time perf counter start print elapsed { f } format elapsed System information OS Platform Distribution Arch Linux arch ARCH TensorFlow installed binary TensorFlow version rc Keras version tf Python version GPU model memory x GTX Ti GB Describe current behavior executing Tensorflow MNIST handwriting example produces warning WARNING tensorflow AutoGraph could transform bound method TopLevelFeature decode example FeaturesDict { image Image shape dtype tf uint label ClassLabel shape dtype tf int num classes } run Please report TensorFlow team When filing bug set verbosity Linux export AUTOGRAPH VERBOSITY attach full output Cause arguments object attribute defaults Code reproduce issue import tensorflow tf import tensorflow datasets tfds tensorflow keras optimizers import Adam def build model filters units kernel size learning rate e model tf keras Sequential tf keras layers Conv D filters filters kernel size kernel size kernel size activation relu input shape tf keras layers MaxPooling D tf keras layers Flatten tf keras layers Dense units activation relu tf keras layers Dense activation softmax model compile loss sparse categorical crossentropy optimizer Adam learning rate metrics accuracy return model datasets info tfds load name mnist info True supervised True mnist train mnist test datasets train datasets test num train examples info splits train num examples num test examples info splits test num examples BUFFER SIZE BATCH SIZE def scale image label image tf cast image tf float image return image label train dataset mnist train map scale shuffle BUFFER SIZE repeat batch BATCH SIZE prefetch buffer size tf data experimental AUTOTUNE eval dataset mnist test map scale repeat batch BATCH SIZE prefetch buffer size tf data experimental AUTOTUNE model build model epochs model fit train dataset validation data eval dataset steps per epoch num train examples epochs validation steps num test examples epochs epochs epochs System information Have I written custom code opposed using stock example script provided TensorFlow N A OS Platform Distribution e g Linux Ubuntu Ubuntu Mobile device e g iPhone Pixel Samsung Galaxy issue happens mobile device TensorFlow installed source binary binary TensorFlow version use command v rc g c Python version Bazel version compiling source N A GCC Compiler version compiling source N A CUDA cuDNN version V GPU model memory Tesla V SXM Describe current behavior In Adam paper subtract following quantity current gradient alpha hat { } sqrt { v beta ^ } + epsilon img width alt Screen Shot PM src https user images githubusercontent com f db ea c fe cae png The Tensorflow implementation subtracts subtly different quantity alpha hat { } sqrt { beta ^ T } sqrt { v } + epsilon img width alt Screen Shot PM src https user images githubusercontent com c db ea fc f f png The difference two expressions first de bias moving average squared gradient v In second bias correction also applied epsilon This manifests scaling epilson quite lot early training steps reducing magnitude gradient update Note bug present PyTorch prior v It fixed PR https github com pytorch pytorch pull That PR description provides useful visualization Describe expected behavior Implement algorithm described paper If old implementation necessary preserve back compat providing flag trigger correct implementation would helpful https arxiv org pdf pdf see final lines Algorithm Notable lines TF implementation regarding issue https github com tensorflow tensorflow blob r tensorflow python keras optimizer v adam py L https github com tensorflow tensorflow blob r tensorflow python keras optimizer v adam py L https github com tensorflow tensorflow blob master tensorflow core kernels training ops cc L em Please make sure build installation issue As per GitHub Policy https github com tensorflow tensorflow blob master ISSUES md address code doc bugs performance issues feature requests build installation issues GitHub tag build template em System information OS Platform Distribution e g Linux Ubuntu Manjaro Linux kernel TensorFlow installed source binary binary I sure I used pip install tensorflow TensorFlow version Python version Python Installed using virtualenv pip conda pip This virtualenv environment though Describe problem Running tf upgrade v file async functions causes crash Provide exact sequence commands steps executed running problem tf upgrade v infile image classification test tf py outfile image classification v test tf py Traceback recent call last File home alex git repos bic bot py bin tf upgrade v line module sys exit main File home alex git repos bic bot py lib python site packages tensorflow core tools compatibility tf upgrade v main py line main args input file output file upgrade File home alex git repos bic bot py lib python site packages tensorflow core tools compatibility tf upgrade v main py line process file upgrader process file filename filename File home alex git repos bic bot py lib python site packages tensorflow core tools compatibility ast edits py line process file temp file File home alex git repos bic bot py lib python site packages tensorflow core tools compatibility ast edits py line process opened file self update string pasta join lines filename File home alex git repos bic bot py lib python site packages tensorflow core tools compatibility ast edits py line update string pasta pasta parse text File home alex git repos bic bot py lib python site packages pasta init py line parse annotator visit File home alex git repos bic bot py lib python site packages pasta base annotate py line visit super AstAnnotator self visit node File home alex git repos bic bot py lib python site packages pasta base annotate py line visit super BaseVisitor self visit node File home alex pyenv versions lib python ast py line visit return visitor node File home alex git repos bic bot py lib python site packages pasta base annotate py line wrapped f self node args kwargs File home alex git repos bic bot py lib python site packages pasta base annotate py line visit Module self generic visit node File home alex pyenv versions lib python ast py line generic visit self visit item File home alex git repos bic bot py lib python site packages pasta base annotate py line visit super AstAnnotator self visit node File home alex git repos bic bot py lib python site packages pasta base annotate py line visit super BaseVisitor self visit node File home alex pyenv versions lib python ast py line visit return visitor node File home alex pyenv versions lib python ast py line generic visit self visit item File home alex git repos bic bot py lib python site packages pasta base annotate py line visit super AstAnnotator self visit node File home alex git repos bic bot py lib python site packages pasta base annotate py line visit super BaseVisitor self visit node File home alex pyenv versions lib python ast py line visit return visitor node File home alex git repos bic bot py lib python site packages pasta base annotate py line wrapped f self node args kwargs File home alex git repos bic bot py lib python site packages pasta base annotate py line visit Return self token return File home alex git repos bic bot py lib python site packages pasta base annotate py line token token val token src token start token line pasta base annotate AnnotationError Expected return found async line async def f Any info logs test tf py async def f return 